<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•ì›ëŒ€ ì‹ í˜¸ë“±</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
        .light { width: 150px; height: 150px; border-radius: 50%; margin: 20px auto; border: 5px solid #333; transition: 0.3s; }
        .green { background-color: #2ecc71; box-shadow: 0 0 30px #2ecc71; }
        .red { background-color: #e74c3c; box-shadow: 0 0 30px #e74c3c; }
        .timer { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        .settings { background: white; padding: 15px; border-radius: 10px; margin-top: 20px; }
        input { width: 50px; padding: 5px; text-align: center; }
        button { padding: 10px 20px; font-size: 1rem; cursor: pointer; border-radius: 5px; border: none; background: #34495e; color: white; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸš¥ ì‹ í˜¸ë“± íƒ€ì´ë¨¸</h1>
    
    <div id="lightCircle" class="light red"></div>
    <div id="statusText" style="font-size: 1.5rem;">ëŒ€ê¸° ì¤‘...</div>
    <div id="timerDisplay" class="timer">00</div>

    <button onclick="syncGreen()" style="background: #27ae60; font-weight: bold;">ì§€ê¸ˆ ì´ˆë¡ë¶ˆ ì‹œì‘! (ë™ê¸°í™”)</button>

    <div class="settings">
        <h3>ì„¤ì • (ì´ˆ ë‹¨ìœ„)</h3>
        ì´ˆë¡ë¶ˆ: <input type="number" id="greenTime" value="27"> ì´ˆ<br>
        ë¹¨ê°„ë¶ˆ: <input type="number" id="redTime" value="133"> ì´ˆ
    </div>

    <script>
        let startTime = null; // ì´ˆë¡ë¶ˆì´ ì‹œì‘ëœ ì‹œì  (Timestamp)

        function syncGreen() {
            startTime = Date.now();
            localStorage.setItem('trafficStartTime', startTime); // ë¸Œë¼ìš°ì €ì— ì €ì¥
            alert("ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ì‹œì‘ ì‹œê°„ ë¶ˆëŸ¬ì˜¤ê¸°
        if(localStorage.getItem('trafficStartTime')) {
            startTime = parseInt(localStorage.getItem('trafficStartTime'));
        }

        function update() {
            if (!startTime) return;

            const greenDuration = parseInt(document.getElementById('greenTime').value);
            const redDuration = parseInt(document.getElementById('redTime').value);
            const totalCycle = greenDuration + redDuration;

            // 1. í˜„ì¬ ì§€ë‚œ ì‹œê°„ ê³„ì‚°
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            
            // 2. ëª¨ë“ˆëŸ¬ ì—°ì‚°: í˜„ì¬ ì‚¬ì´í´ ë‚´ì—ì„œ ëª‡ ì´ˆ ì§€ë‚¬ëŠ”ì§€
            const currentProgress = elapsed % totalCycle;

            const lightCircle = document.getElementById('lightCircle');
            const timerDisplay = document.getElementById('timerDisplay');
            const statusText = document.getElementById('statusText');

            if (currentProgress < greenDuration) {
                // ì´ˆë¡ë¶ˆ ìƒíƒœ
                lightCircle.className = "light green";
                statusText.innerText = "ì´ˆë¡ë¶ˆ - ê±´ë„ˆì„¸ìš”!";
                timerDisplay.innerText = greenDuration - currentProgress;
            } else {
                // ë¹¨ê°„ë¶ˆ ìƒíƒœ
                lightCircle.className = "light red";
                statusText.innerText = "ë¹¨ê°„ë¶ˆ - ì •ì§€";
                timerDisplay.innerText = totalCycle - currentProgress;
            }
        }

        // 0.5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ (ë¶€ë“œëŸ½ê²Œ í‘œì‹œ)
        setInterval(update, 500);
    </script>
</body>
</html>